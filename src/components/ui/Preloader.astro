---
/**
 * Preloader / Welcome Animation
 * Shows a premium intro animation on first visit
 */
---

<div id="preloader" class="preloader">
    <div class="preloader-content">
        <!-- Animated Logo/Name -->
        <div class="preloader-text">
            <span class="char">B</span>
            <span class="char">H</span>
            <span class="char">A</span>
            <span class="char">R</span>
            <span class="char">A</span>
            <span class="char">T</span>
            <span class="char">H</span>
        </div>
        <div class="preloader-subtitle">
            <span>Software Architect</span>
        </div>
        <div class="preloader-line"></div>
    </div>
</div>

<style>
    .preloader {
        position: fixed;
        inset: 0;
        z-index: 99999;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #0a0a0a;
        transition:
            opacity 0.6s ease,
            visibility 0.6s ease;
    }

    .preloader.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
    }

    .preloader-content {
        text-align: center;
    }

    .preloader-text {
        display: flex;
        gap: 0.1em;
        font-family: "Archivo Black", sans-serif;
        font-size: clamp(2rem, 8vw, 5rem);
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: -0.02em;
        color: white;
        overflow: hidden;
    }

    .char {
        display: inline-block;
        opacity: 0;
        transform: translateY(100%);
        animation: charReveal 0.6s cubic-bezier(0.19, 1, 0.22, 1) forwards;
    }

    .char:nth-child(1) {
        animation-delay: 0.1s;
    }
    .char:nth-child(2) {
        animation-delay: 0.15s;
    }
    .char:nth-child(3) {
        animation-delay: 0.2s;
    }
    .char:nth-child(4) {
        animation-delay: 0.25s;
    }
    .char:nth-child(5) {
        animation-delay: 0.3s;
    }
    .char:nth-child(6) {
        animation-delay: 0.35s;
    }
    .char:nth-child(7) {
        animation-delay: 0.4s;
    }

    @keyframes charReveal {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .preloader-subtitle {
        margin-top: 1rem;
        font-family: "Manrope", sans-serif;
        font-size: 0.875rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.3em;
        color: #10b981;
        opacity: 0;
        animation: fadeIn 0.6s ease forwards;
        animation-delay: 0.6s;
    }

    @keyframes fadeIn {
        to {
            opacity: 1;
        }
    }

    .preloader-line {
        width: 60px;
        height: 2px;
        margin: 1.5rem auto 0;
        background: #10b981;
        transform: scaleX(0);
        transform-origin: left;
        animation: lineExpand 0.8s cubic-bezier(0.19, 1, 0.22, 1) forwards;
        animation-delay: 0.8s;
    }

    @keyframes lineExpand {
        to {
            transform: scaleX(1);
        }
    }

    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce) {
        .char {
            animation: none;
            opacity: 1;
            transform: none;
        }
        .preloader-subtitle {
            animation: none;
            opacity: 1;
        }
        .preloader-line {
            animation: none;
            transform: scaleX(1);
        }
    }
</style>

<script>
    function initPreloader() {
        const preloader = document.getElementById("preloader");
        if (!preloader) return;

        // Check if this is a page navigation (not first load)
        const isPageNavigation = sessionStorage.getItem("visited");

        if (isPageNavigation) {
            // Skip preloader on subsequent navigations
            preloader.remove();
            return;
        }

        // Mark as visited
        sessionStorage.setItem("visited", "true");

        // Hide preloader after animation completes
        const hideDelay = 2000; // 2 seconds total animation time

        setTimeout(() => {
            preloader.classList.add("hidden");

            // Remove from DOM after transition
            setTimeout(() => {
                preloader.remove();
            }, 600);
        }, hideDelay);
    }

    // Run on initial load
    initPreloader();

    // Handle view transitions
    document.addEventListener("astro:page-load", () => {
        const preloader = document.getElementById("preloader");
        if (preloader) {
            preloader.remove();
        }
    });
</script>
