---
/**
 * Language Distribution Chart
 * Displays programming languages used across repositories
 */
import Heading from "./Heading.astro";
import { fetchLanguageDistribution } from "@/lib/github";

const languages = await fetchLanguageDistribution();

// Fallback mock data if API fails
const displayLanguages =
    languages.length > 0
        ? languages
        : [
              { name: "TypeScript", color: "#3178c6", percentage: 45 },
              { name: "Python", color: "#3572A5", percentage: 25 },
              { name: "JavaScript", color: "#f1e05a", percentage: 15 },
              { name: "Rust", color: "#dea584", percentage: 8 },
              { name: "Go", color: "#00ADD8", percentage: 7 },
          ];
---

<section class="reveal px-4 py-16 md:px-8">
    <div class="mx-auto max-w-[1000px]">
        <Heading variant="section" class="mb-8">Languages</Heading>

        <!-- Stacked bar -->
        <div class="h-4 rounded-full overflow-hidden flex mb-6">
            {
                displayLanguages.map((lang) => (
                    <div
                        class="h-full transition-all duration-300 hover:opacity-80 relative group"
                        style={`width: ${lang.percentage}%; background-color: ${lang.color};`}
                        title={`${lang.name}: ${lang.percentage}%`}
                    >
                        <span class="absolute -top-8 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 text-xs bg-black dark:bg-white text-white dark:text-black px-2 py-1 rounded whitespace-nowrap transition-opacity">
                            {lang.name}: {lang.percentage}%
                        </span>
                    </div>
                ))
            }
        </div>

        <!-- Legend -->
        <div class="flex flex-wrap gap-4">
            {
                displayLanguages.map((lang) => (
                    <div class="flex items-center gap-2">
                        <div
                            class="w-3 h-3 rounded-full"
                            style={`background-color: ${lang.color};`}
                        />
                        <span class="text-sm text-gray-600 dark:text-gray-400">
                            {lang.name}
                            <span class="text-gray-400 dark:text-gray-500 ml-1">
                                {lang.percentage}%
                            </span>
                        </span>
                    </div>
                ))
            }
        </div>
    </div>
</section>
