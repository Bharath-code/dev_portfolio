---

---

<button
    type="button"
    class="theme-toggle relative inline-flex h-9 w-9 items-center justify-center rounded-full border border-base bg-white/5 transition-colors hover:bg-white/10 text-muted hover:text-main focus:outline-none focus:ring-2 focus:ring-signal-emerald focus:ring-offset-2 focus:ring-offset-void-black"
    aria-label="Toggle theme"
>
    <span class="sr-only">Toggle theme</span>
    <!-- Sun icon -->
    <svg
        class="sun-icon h-5 w-5 opacity-0 scale-50 transition-all duration-300 absolute inset-0 m-auto data-[active=true]:opacity-100 data-[active=true]:scale-100"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
    >
        <circle cx="12" cy="12" r="4"></circle>
        <path d="M12 2v2"></path>
        <path d="M12 20v2"></path>
        <path d="m4.93 4.93 1.41 1.41"></path>
        <path d="m17.66 17.66 1.41 1.41"></path>
        <path d="M2 12h2"></path>
        <path d="M20 12h2"></path>
        <path d="m6.34 17.66-1.41-1.41"></path>
        <path d="m19.07 4.93-1.41 1.41"></path>
    </svg>
    <!-- Moon icon -->
    <svg
        class="moon-icon h-5 w-5 opacity-0 scale-50 transition-all duration-300 absolute inset-0 m-auto data-[active=true]:opacity-100 data-[active=true]:scale-100"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
    >
        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
    </svg>
</button>

<script is:inline>
    {
        // Avoid re-declaring global variables if this script runs multiple times
        if (!window.themeToggleInitialized) {
            window.themeToggleInitialized = true;

            const getTheme = () => {
                if (
                    typeof localStorage !== "undefined" &&
                    localStorage.getItem("theme")
                ) {
                    return localStorage.getItem("theme");
                }
                if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                    return "dark";
                }
                return "light";
            };

            const setTheme = (theme) => {
                const isDark = theme === "dark";

                // Update HTML class
                if (isDark) {
                    document.documentElement.classList.add("dark");
                } else {
                    document.documentElement.classList.remove("dark");
                }

                localStorage.setItem("theme", theme);

                // Sync all toggle buttons
                const toggles = document.querySelectorAll(".theme-toggle");
                toggles.forEach((toggle) => {
                    const sun = toggle.querySelector(".sun-icon");
                    const moon = toggle.querySelector(".moon-icon");

                    if (!isDark) {
                        sun?.setAttribute("data-active", "true");
                        moon?.setAttribute("data-active", "false");
                    } else {
                        sun?.setAttribute("data-active", "false");
                        moon?.setAttribute("data-active", "true");
                    }
                });
            };

            // Toggle function
            const toggleTheme = () => {
                const currentTheme = getTheme();
                const newTheme = currentTheme === "light" ? "dark" : "light";
                setTheme(newTheme);
            };

            // Event Delegation: Listen on document for any .theme-toggle clicks
            document.addEventListener("click", (e) => {
                if (e.target.closest(".theme-toggle")) {
                    toggleTheme();
                }
            });

            // Initialize on load
            setTheme(getTheme());

            // Listen for view transitions (Astro) to re-sync state
            document.addEventListener("astro:after-swap", () => {
                setTheme(getTheme());
            });
        }
    }
</script>
