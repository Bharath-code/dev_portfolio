---
import { ArrowUpRight, Star, GitFork, Clock } from "lucide-react";

interface Metric {
    label: string;
    value: string;
}

interface GitHubStats {
    stargazerCount: number;
    forkCount: number;
    updatedAt: string;
}

interface Props {
    slug?: string;
    title: string;
    description: string;
    badges: string[];
    metrics: Metric[];
    link: string;
    githubStats?: GitHubStats;
}

const { slug, title, description, badges, metrics, link, githubStats } =
    Astro.props;
const href = slug ? `/projects/${slug}` : link;
const isExternal = !slug;

// Format relative time for "Last Updated"
function formatRelativeTime(dateStr: string): string {
    const date = new Date(dateStr);
    const now = new Date();
    const diffMs = now.getTime() - date.getTime();
    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

    if (diffDays === 0) return "today";
    if (diffDays === 1) return "yesterday";
    if (diffDays < 7) return `${diffDays} days ago`;
    if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
    if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
    return `${Math.floor(diffDays / 365)} years ago`;
}

const lastUpdated = githubStats?.updatedAt
    ? formatRelativeTime(githubStats.updatedAt)
    : null;
---

<a
    href={href}
    target={isExternal ? "_blank" : undefined}
    rel={isExternal ? "noopener noreferrer" : undefined}
    class="group relative block h-full overflow-hidden rounded-2xl bg-black/5 dark:bg-white/5 p-8 border border-transparent transition-all duration-500 hover:bg-black/10 dark:hover:bg-white/10 hover:-translate-y-2 hover:border-black/5 dark:hover:border-white/5 shadow-none hover:shadow-2xl hover:shadow-black/5 dark:hover:shadow-white/5"
>
    <!-- Background Highlight -->
    <div
        class="absolute inset-0 bg-gradient-to-br from-signal-emerald/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"
    >
    </div>

    <div class="relative z-10">
        <div class="mb-6 flex items-start justify-between">
            <div class="flex flex-wrap gap-2">
                {
                    badges.map((badge) => (
                        <span class="rounded-full border border-black/10 dark:border-white/10 bg-black/5 dark:bg-white/5 px-3 py-1 text-xs font-medium uppercase tracking-wider text-gray-600 dark:text-gray-400 group-hover:text-black dark:group-hover:text-white transition-colors">
                            {badge}
                        </span>
                    ))
                }
                {/* GitHub Stats Badges */}
                {
                    githubStats && (
                        <>
                            <span class="rounded-full border border-signal-emerald/30 bg-signal-emerald/10 px-3 py-1 text-xs font-medium text-signal-emerald flex items-center gap-1">
                                <Star className="w-3 h-3" />
                                {githubStats.stargazerCount}
                            </span>
                            <span class="rounded-full border border-signal-emerald/30 bg-signal-emerald/10 px-3 py-1 text-xs font-medium text-signal-emerald flex items-center gap-1">
                                <GitFork className="w-3 h-3" />
                                {githubStats.forkCount}
                            </span>
                        </>
                    )
                }
            </div>
            <ArrowUpRight
                className="h-6 w-6 text-gray-500 dark:text-gray-400 transition-all duration-300 group-hover:text-signal-emerald group-hover:scale-110"
            />
        </div>

        <h3
            class="mb-4 font-display text-2xl font-bold text-black dark:text-white group-hover:text-signal-emerald transition-colors"
        >
            {title}
        </h3>

        <p
            class="mb-8 text-sm leading-relaxed text-gray-600 dark:text-gray-400"
        >
            {description}
        </p>

        <div
            class="grid grid-cols-2 md:grid-cols-3 gap-4 border-t border-black/10 dark:border-white/10 pt-6"
        >
            {
                metrics.slice(0, githubStats ? 2 : 4).map((metric) => (
                    <div>
                        <p class="text-xs uppercase tracking-wider text-gray-500 dark:text-gray-500 mb-1">
                            {metric.label}
                        </p>
                        <p class="font-display text-lg font-bold text-black dark:text-white transition-colors group-hover:text-signal-emerald">
                            {metric.value}
                        </p>
                    </div>
                ))
            }
            {/* GitHub Stats in Metrics Grid */}
            {
                githubStats && lastUpdated && (
                    <div>
                        <p class="text-xs uppercase tracking-wider text-gray-500 dark:text-gray-500 mb-1 flex items-center gap-1">
                            <Clock className="w-3 h-3" />
                            Updated
                        </p>
                        <p class="font-display text-lg font-bold text-black dark:text-white transition-colors group-hover:text-signal-emerald">
                            {lastUpdated}
                        </p>
                    </div>
                )
            }
        </div>
    </div>
</a>
